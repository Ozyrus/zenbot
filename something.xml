<context>
	<input id = "startmessage" pattern = "/start">
		<output value=" hey there! I am a bot for getting a Taxi. Say hey to me! You can (nearly) always say restart to start again."/> <!-- startmessage-->
		<context id = "mainscenario">
		    <input id ="greeting" pattern="(hi|hello|hey|sup|start) *">
		        <!-- Greet the user if we know his/her name -->
		        <output value="Hello $UserName!" if="full($UserName)"/>
		        <context id = "adressask"/>
		        <!-- Or activate an inner context to ask the user about his/her name -->
		        <context if="empty($UserName)" modal="true"> <!-- We use a modal context, so our bot will recognize any text as the user’s name -->
		            <output value="Hi! What is your name?"/>

		            <input pattern="$Text">
		                <!-- Store the user’s name in the UserName variable with "user" scope to save it into database -->
		                <var name="UserName" value="$Text" scope="user"/>
		                <output value="Nice to meet you, $UserName!"/> <!-- Using the placeholder in output -->
		                <context if="empty($Adress)" modal = "true" id = 'adressask'>
				        	<output value="$UserName, i'm going to need your adress now. Our service operates only in Moscow, so you gotta write some Moscow street and house number"/>
				        	<input pattern = "$Text">
				        		<!--Store user's adress -->
				        	<var name="Adress" value="$Text" scope="user"/>
			        		<output value="Alright, got it. Your adress is $Adress"/>
				        	<context if="empty($cartype)" modal = "true" id = "cartype">
				        		<pattern name="Business" value="(Business|VIP|business)"/>
				        		<pattern name="Economy" value="(Economy|Econom|Cheap|economy)"/>
				        		<pattern name="Comfort" value="(Comfort|Normal|Any|comfort)"/>
				        		<output value = "Now for the vehicle type. Around your location, there are Buisness class cars available, economy cars and comfort class. Which one would you like?" />
					        	<input pattern = "[$Business|$Economy|$Comfort] *">
					        		<context id = "Business" if = "full($Business)">
					        			<output value="Okay, Business class it is. Is that right?"/>
					        			<input pattern = "(yes|yeah|sure|ok|Yes|Yeah|Sure)">
					        			<var name="cartype" value="Business" scope="user"/>
					        				<context id = "dropoff"/>
					        			</input>
					        			<input pattern = "(no|nope|No|Nope|Nah|nah)">
					        				<output value ="Alright, just say again what would you like"/>
					        				<context id = "cartype"/>
					        			</input>
						        	</context>
						        	<context id = "Economy" if = "full($Economy)">
					        			<output value="Okay, Economy class, is it?"/>
					        			<input pattern = "(yes|yeah|sure|ok|Yes|Yeah|Sure)">
					        			<var name="cartype" value="Economy" scope="user"/>
					        				<context id = "dropoff"/>
					        			</input>
					        			<input pattern = "(no|nope|No|Nope|Nah|nah)">
					        				<output value ="Alright, just say again what would you like"/>
					        				<context id = "cartype"/>
					        			</input>
						        	</context>
						        	<context id = "Comfort" if = "full($Comfort)">
					        			<output value="Okay, Comfort class, is it?"/>
					        			<input pattern = "(yes|yeah|sure|ok|Yes|Yeah|Sure)">
					        			<var name="cartype" value="Comfort" scope="user"/>
					        				<context id = "dropoff"/>
					        			</input>
					        			<input pattern = "(no|nope|No|Nope|Nah|nah)">
					        				<output value ="Alright, just say again what would you like"/>
					        				<context id = "cartype"/>
					        			</input>
						        	</context>
						        	<context id = "Nothing" if = "empty$Economy and empty$Business and empty$Comfort">
					        			<output value="Don't quite understand you, sorry. Maybe I should order a comfort for you?"/>
					        			<input pattern = "(yes|yeah|sure|ok|Yes|Yeah|Sure)">
					        			<var name="cartype" value="Business" scope="user"/>
					        				<context id = "dropoff"/>
					        			</input>
					        			<input pattern = "(no|nope|No|Nope|Nah|nah)">
					        				<output value ="Alright, just say again what would you like"/>
					        				<context id = "cartype"/>
					        			</input>
						        	</context>
						        </input>
						        <input pattern = "restart">
									<context id = "mainscenario"/>
								</input>
				        	</context>
				        	</input>
				        	<input pattern = "restart">
								<context id = "mainscenario"/>
							</input>
				        </context>
				    </input>
				    <input pattern = "restart">
						<context id = "mainscenario"/>
					</input>
		        </context>
		    </input>
		    <input pattern = "restart">
				<context id = "mainscenario"/>
			</input>
		</context>
		<context id="dropoff">
				<output value="$UserName, i'm going to need your dropoff adress now. Our service operates only in Moscow, so you gotta write some Moscow street and house number"/>
					<input pattern = "$Text">
						<!--Store user's dropoff adress -->
					<var name="DropoffAdress" value="$Text" scope="user"/>
						<output value="Alright, got it. Your dropoff adress is $DropoffAdress"/>
					</input>
					<input pattern = "restart">
						<context id = "mainscenario"/>
					</input>
		</context>
		<context id = "Ridecalc">
			<output value="$UserName, Your ridefare will be 450 Roubles, for ride in $cartype car from $Adress to $DropoffAdress. Is that okay for you?"/>
				<input pattern = "(Yes|Yea|Yeah|Ok|Fine|Y|y)">
					<output value = "Great! Your car will be waiting in 5 minutes"/>
						<input pattern ='$Text'>
							<output value="Your taxi is on the way. It's BMW M5, number E545KX. ALl further contact is through driver. Cheers!"/>
						</input>
						<input pattern = "restart">
							<context id = "mainscenario"/>
						</input>
				</input>
				<input pattern = "(No|Nope|Nah|N|no)">
					<output value = "That's okay. You can just choose another class or dropoff adress!"/>
					<context id ="cartype"/>
				</input>
				<input pattern = "restart">
					<context id = "mainscenario"/>
				</input>
		</context>	
	</input>
</context>